<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
    function getAllProvider(){
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/provider/lists",
            success: function (data){
                showAllProvider(data)
            }
        })
    }
    function showAllProvider(lists){
        let res = "<tr>\n" +
            "    <td>STT</td>\n" +
            "    <td>Name</td>\n" +
            "</tr>\n";
        for (let i = 0; i < lists.length; i++) {
            let provider = lists[i];
            res += "<tr>\n" +
                "    <td>" + (i +1)       +   "</td>\n" +
                "    <td>" + provider.name  + "</td>\n" +
                `<td><a class="deleteProvider" onclick='deleteProviderById($(this))' href="${provider.id}">Delete</a></td></tr>`;
        }
        document.getElementById("display").innerHTML = "<table>" + res + "</table>";
    }
    function deleteProviderById(a){
        let providerId = a.attr("href");
        $.ajax({
            type: "DELETE",
            url: `http://localhost:8080/provider/${providerId}`,
            success: function (data) {
                a.parent().parent().remove();
            }

        });
        //chặn sự kiện mặc định của thẻ
        event.preventDefault();
    }

    function checkboxService(){
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/serProvider/lists",
            success: function (data){
                document.getElementById("checkbox").innerHTML = createCheckboxService(data);
            }
        })
    }
    function serviceLength(){
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/serProvider/lists",
            success: function (data){
                return data.length;
            }
        })
    }
    function findService(id) {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/serProvider/" +id,
            success: function (data){
                return data;
            }
        })
    }
    function createListServiceByCheckbox(){
        let arrayService = new Array();
        for (let i = 1; i <= serviceLength(); i++) {
            let id = "service" + i;
            document.getElementById(id).onclick = function (){
                if (this.checked){
                    let idService = document.getElementById(id).value;
                    arrayService.push(findService(idService));
                }
            }
        }
        return arrayService;
    }
    function createCheckboxService(data){
        let checkbox = "";
        for (let i = 0; i < data.length; i++) {
            let name = data[i].name;
            checkbox += "<input type=\"checkbox\" id=\"service" + (i+1) +"\"" + "value=\"" + data[i].id + "\">"+name;
        }
        return checkbox;
    }
    function showFormAddProvider(userid){

        let form = "<input type=\"text\" id=\"name\" placeholder=\"Ho va ten\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"age\" placeholder=\"tuoi\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"city\" placeholder=\"thanh pho dang sinh song\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"gender\" placeholder=\"gioi tinh\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"nationality\" placeholder=\"quoc tich\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"hobby\" placeholder=\"so thich\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"height\" placeholder=\"chieu cao\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"weight\" placeholder=\"can nang\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"description\" placeholder=\"mo ta them\">\n" +
            "<br>" +
            "<input type=\"text\" id=\"facebook\" placeholder=\"link facebook\">\n" +
            "<br>" +
            "<input type=\"number\" id=\"price\"placeholder=\"gia thue theo gio\">\n" +
            "<br>" +
            "<p>Chon dich vu:</p>" +
            "<div id=\"checkbox\"></div>" +
            "<br>" +
            "<button onclick=\"saveProvider()\">Save</button>" +
            "<br>" +
            "<input type=\"hidden\" id=\"userid\" value=\"" + userid + "\">\n"
            checkboxService();

        document.getElementById("display").innerHTML = form;
    }
    function findUser(userid){
        $.ajax({
            type: "GET",
            url: `http://localhost:8080/user/${userid}`,
            success: function (data){
                return data;
            }
        })
    }
    function saveProvider(){
        let hobby = document.getElementById("hobby").value;
        let name = document.getElementById("name").value;
        let age = document.getElementById("age").value;
        let city = document.getElementById("city").value;
        let gender = document.getElementById("gender").value;
        let nationality = document.getElementById("nationality").value;
        let height = document.getElementById("height").value;
        let weight = document.getElementById("weight").value;
        let description = document.getElementById("description").value;
        let facebook = document.getElementById("facebook").value;
        let price = document.getElementById("price").value;
        let userid = document.getElementById("userid").value;
        let nal = {
            hobby: hobby,
            name: name,
            age: age,
            city: city,
            gender: gender,
            nationality: nationality,
            height: height,
            weight: weight,
            description: description,
            facebook: facebook,
            price: price,
            service : createListServiceByCheckbox(),
            status: "active",
            hasBeenHired: 0,
            view: 0,
            user : findUser(userid)
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
            },
            type: "POST",
            url: "http://localhost:8080/provider/save",
            data: JSON.stringify(nal),
            success: getAllProvider(),

            error: function (err){
                console.log(err)
            }
        })
    }
    </script>
</head>
<body onload="getAllProvider()">
<button onclick="showFormAddProvider(3)">Add Provider</button>
    <div id="display"></div>

<p>Đây là Provider</p>


</body>
<html>